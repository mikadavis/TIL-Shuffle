<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIL Shuffle - Game Show Edition</title>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q98010P7LZ"></script>
    <script>
        console.log('[Analytics] Initializing Google Analytics with Tag ID: G-Q98010P7LZ');
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Q98010P7LZ');
        console.log('[Analytics] Google Analytics initialized successfully');
    </script>

    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Righteous&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- API Key Validation Modal -->
    <div id="apiKeyModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h1 class="modal-title">One-Time Setup Required to Enjoy Vibe Coded Prototypes</h1>

            <p class="modal-explanation">
                As required by Meta guidelines, every user needs to go through this one-time flow, which should be required only once for all prototypes created through the
                <a href="http://fburl.com/vibe-code" target="_blank" rel="noopener noreferrer">Vibe Coding @ Meta (XFN-Friendly)</a> Workshop
            </p>

            <div class="modal-important-notes">
                <h3>Important Notes:</h3>
                <ol>
                    <li>An API key is essentially a way for meta servers to know that you are the one using the prototype, and this is required to enable the functionalities used in this prototype, such as meta-hosted LLMs to process the prototype logic.</li>
                    <li>The URL provided below is an internal, Meta-only service approved for company-wide use, regardless of your organization or function.</li>
                </ol>
            </div>

            <div class="modal-instructions">
                <h3>Setup Instructions:</h3>
                <ul>
                    <li><strong>Step 0:</strong> If never done before, go to <a href="https://wearables-ape.io/consent" target="_blank" rel="noopener noreferrer">https://wearables-ape.io/consent</a> and sign the consent form</li>
                    <li><strong>Step 1:</strong> Go to <a href="https://wearables-ape.io/settings/api-keys" target="_blank" rel="noopener noreferrer">https://wearables-ape.io/settings/api-keys</a></li>
                    <li><strong>Step 2:</strong> Press the "New API Key" button, and copy the API key <em>(long string of letters/numbers)</em></li>
                    <li><strong>Step 3:</strong> Paste your new API key into the field below and click "Save".</li>
                </ul>
            </div>

            <div class="modal-input-section">
                <input
                    type="text"
                    id="apiKeyInput"
                    placeholder="Paste your API key here..."
                    class="api-key-input"
                >
                <button id="saveApiKeyBtn" class="save-btn">Save</button>
            </div>

            <div id="apiKeyError" class="error-message" style="display: none;"></div>
            <div id="apiKeySuccess" class="success-message" style="display: none;"></div>
        </div>
    </div>

    <!-- Game ID Modal (Create Game) -->
    <div id="createGameModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h1 class="modal-title">ğŸ® New Game Created!</h1>

            <p class="modal-explanation">
                Your game has been created! Share this Game ID with your team so they can join and add their TILs.
            </p>

            <div class="game-id-display">
                <label>Game ID:</label>
                <div class="game-id-box">
                    <input type="text" id="displayGameId" readonly class="game-id-input">
                    <button id="copyGameIdBtn" class="copy-btn">ğŸ“‹ Copy</button>
                </div>
            </div>

            <div class="modal-info">
                <p><strong>â° Important:</strong> Games expire after 30 days.</p>
                <p><strong>âœ¨ Next Steps:</strong></p>
                <ol>
                    <li>Copy the Game ID above</li>
                    <li>Share it with your team (via Slack, email, etc.)</li>
                    <li>Add your TILs and submit</li>
                    <li>When everyone has submitted, start the game!</li>
                </ol>
            </div>

            <button id="closeCreateGameModal" class="save-btn">Got It!</button>
        </div>
    </div>

    <!-- Game ID Modal (Join Game) -->
    <div id="joinGameModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h1 class="modal-title">ğŸ¯ Join Existing Game</h1>

            <p class="modal-explanation">
                Enter the Game ID shared by your teammate to join their game and add your TILs.
            </p>

            <div class="modal-input-section">
                <input
                    type="text"
                    id="joinGameIdInput"
                    placeholder="Paste Game ID here..."
                    class="api-key-input"
                >
                <button id="joinGameBtn" class="save-btn">Join Game</button>
            </div>

            <div id="joinGameError" class="error-message" style="display: none;"></div>
            <div id="joinGameSuccess" class="success-message" style="display: none;"></div>

            <button id="closeJoinGameModal" class="secondary-btn" style="margin-top: 15px;">Cancel</button>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="appContainer" style="display: none;">
        <header class="app-header">
            <h1 class="app-title">ğŸ² TIL SHUFFLE ğŸ²</h1>
            <p class="app-subtitle">Test Your Team's Knowledge!</p>
            <div id="gameIdBanner" class="game-id-banner" style="display: none;">
                <span>Game ID: <strong id="bannerGameId"></strong></span>
                <button id="copyGameIdBannerBtn" class="copy-banner-btn">ğŸ“‹</button>
            </div>
        </header>

        <!-- Entry Mode -->
        <div id="entryMode" class="mode-container">
            <div class="entry-section">
                <h2 class="section-title">âœ¨ Share Your Learning âœ¨</h2>
                <p class="section-description">Enter what you learned this week. The more the merrier!</p>

                <!-- Game Selection Buttons -->
                <div id="gameSelectionButtons" class="game-selection-buttons">
                    <button id="createNewGameBtn" class="game-btn create-game-btn">ğŸ® Create New Game</button>
                    <button id="joinExistingGameBtn" class="game-btn join-game-btn">ğŸ¯ Join Existing Game</button>
                </div>

                <div id="entryFormsContainer">
                    <!-- Dynamic entry forms will be added here -->
                </div>

                <button id="addEntryBtn" class="add-entry-btn">â• Add Another TIL</button>

                <div class="action-buttons">
                    <button id="submitAllBtn" class="submit-btn">ğŸš€ Submit All TILs</button>
                    <button id="startGameBtn" class="start-game-btn">ğŸ® Start Game</button>
                </div>
            </div>
        </div>

        <!-- Game Mode -->
        <div id="gameMode" class="mode-container" style="display: none;">
            <div class="game-section">
                <div class="progress-bar">
                    <span id="progressText">Loading...</span>
                </div>

                <div id="tilCard" class="til-card">
                    <div class="til-content">
                        <h3 class="til-label">Today I Learned...</h3>
                        <p id="tilText" class="til-text"></p>
                    </div>

                    <div id="answerSection" class="answer-section" style="display: none;">
                        <div class="answer-reveal">
                            <h4 class="answer-label">Who said it?</h4>
                            <p id="answerName" class="answer-name"></p>
                        </div>
                    </div>
                </div>

                <div class="game-controls">
                    <button id="revealBtn" class="reveal-btn">ğŸ­ Reveal Answer</button>
                    <button id="nextTilBtn" class="next-btn" style="display: none;">â¡ï¸ Next TIL</button>
                </div>

                <div class="game-actions">
                    <button id="backToEntryBtn" class="secondary-btn">ğŸ“ Add More TILs</button>
                    <button id="newSessionBtn" class="secondary-btn">ğŸ”„ New Session</button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>
    </div>

    <script src="api.js"></script>
    <script src="app.js"></script>
</body>
</html>
